{{- /* BEGIN DEFINE */ -}}

{{- define "Enum"}}
enum {{.Name}} {
{{- range .EnumFields}}
	{{.Name}} = {{.Value}};
{{- end}}
}
{{- end}}

{{- define "Entity"}}
message {{.Name}} {
{{- range .Fields}}
{{- if .Repeated}}
{{- if eq .Type "timestamp"}}
	repeated google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if eq .Type "duration"}}
	repeated google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else if eq .Type "empty"}}
	repeated google.protobuf.Empty {{.Name}} = {{.Number}};
{{- else}}
	repeated {{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- else if len .KeyType}}
{{- if eq .Type "timestamp"}}
	map<{{.KeyType}}, google.protobuf.Timestamp> {{.Name}} = {{.Number}};
{{- else if eq .Type "duration"}}
	map<{{.KeyType}}, google.protobuf.Duration> {{.Name}} = {{.Number}};
{{- else if eq .Type "empty"}}
	map<{{.KeyType}}, google.protobuf.Empty> {{.Name}} = {{.Number}};
{{- else}}
	map<{{.KeyType}}, {{.Type}}> {{.Name}} = {{.Number}};
{{- end}}
{{- else}}
{{- if eq .Type "timestamp"}}
	google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if eq .Type "duration"}}
	google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else if eq .Type "empty"}}
	google.protobuf.Empty {{.Name}} = {{.Number}};
{{- else}}
	{{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- end}}
{{- end}}
}
{{- end}}

{{- define "Component"}}
message {{.Name}} {
{{- range .Fields}}
{{- if .Repeated}}
{{- if eq .Type "timestamp"}}
	repeated google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if eq .Type "duration"}}
	repeated google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else if eq .Type "empty"}}
	repeated google.protobuf.Empty {{.Name}} = {{.Number}};
{{- else}}
	repeated {{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- else if len .KeyType}}
{{- if eq .Type "timestamp"}}
	map<{{.KeyType}}, google.protobuf.Timestamp> {{.Name}} = {{.Number}};
{{- else if eq .Type "duration"}}
	map<{{.KeyType}}, google.protobuf.Duration> {{.Name}} = {{.Number}};
{{- else if eq .Type "empty"}}
	map<{{.KeyType}}, google.protobuf.Empty> {{.Name}} = {{.Number}};
{{- else}}
	map<{{.KeyType}}, {{.Type}}> {{.Name}} = {{.Number}};
{{- end}}
{{- else}}
{{- if eq .Type "timestamp"}}
	google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if eq .Type "duration"}}
	google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else if eq .Type "empty"}}
	google.protobuf.Empty {{.Name}} = {{.Number}};
{{- else}}
	{{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- end}}
{{- end}}
}
{{- end}}

{{- /* END DEFINE */ -}}

// Code generated by kds. DO NOT EDIT.

syntax = "proto3";

package {{.Package}};

{{- if len .Imports}}
{{/* empty line */}}
{{- end}}
{{- range .Imports}}
import "{{.}}.proto";
{{- end}}

{{- if len .ProtoImports}}
{{/* empty line */}}
{{- range .ProtoImports}}
import "{{.}}";
{{- end}}
{{- end}}

option go_package="{{.ProtoGoPackage}}";

{{- range .Defs}}
{{- if findEnum .Name}}
{{template "Enum" .}}
{{- else if findEntity .Name}}
{{template "Entity" .}}
{{- else if findComponent .Name}}
{{template "Component" .}}
{{- end}}
{{- end}}