{{- /* BEGIN DEFINE */ -}}

{{- define "Enum"}}
enum {{.Name}} {
{{- range .EnumFields}}
	{{.Name}} = {{.Value}};
{{- end}}
}
{{- end}}

{{- define "Entity"}}
message {{.Name}} {
{{- range .Fields}}
{{- if .Repeated}}
{{- if isTimestamp .Type}}
	repeated google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	repeated google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else if isEmpty .Type}}
	repeated google.protobuf.Empty {{.Name}} = {{.Number}};
{{- else}}
	repeated {{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- else if len .KeyType}}
{{- if isTimestamp .Type}}
	map<{{.KeyType}}, google.protobuf.Timestamp> {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	map<{{.KeyType}}, google.protobuf.Duration> {{.Name}} = {{.Number}};
{{- else if isEmpty .Type}}
	map<{{.KeyType}}, google.protobuf.Empty> {{.Name}} = {{.Number}};
{{- else}}
	map<{{.KeyType}}, {{.Type}}> {{.Name}} = {{.Number}};
{{- end}}
{{- else}}
{{- if isTimestamp .Type}}
	google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else if isEmpty .Type}}
	google.protobuf.Empty {{.Name}} = {{.Number}};
{{- else}}
	{{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- end}}
{{- end}}
}
{{- end}}

{{- define "Component"}}
message {{.Name}} {
{{- range .Fields}}
{{- if .Repeated}}
{{- if isTimestamp .Type}}
	repeated google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	repeated google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else if isEmpty .Type}}
	repeated google.protobuf.Empty {{.Name}} = {{.Number}};
{{- else}}
	repeated {{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- else if len .KeyType}}
{{- if isTimestamp .Type}}
	map<{{.KeyType}}, google.protobuf.Timestamp> {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	map<{{.KeyType}}, google.protobuf.Duration> {{.Name}} = {{.Number}};
{{- else if isEmpty .Type}}
	map<{{.KeyType}}, google.protobuf.Empty> {{.Name}} = {{.Number}};
{{- else}}
	map<{{.KeyType}}, {{.Type}}> {{.Name}} = {{.Number}};
{{- end}}
{{- else}}
{{- if isTimestamp .Type}}
	google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else if isEmpty .Type}}
	google.protobuf.Empty {{.Name}} = {{.Number}};
{{- else}}
	{{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- end}}
{{- end}}
}
{{- end}}

{{- /* END DEFINE */ -}}

// Code generated by kds. DO NOT EDIT.

syntax = "proto3";

package {{.Package}};

{{- if len .Imports}}
{{/* 空一行 */}}
{{- end}}
{{- range .Imports}}
import "{{.}}.proto";
{{- end}}

{{- if or .ImportTimestamp .ImportDuration}}
{{/* 空一行 */}}
{{- end}}
{{- if .ImportTimestamp}}
import "google/protobuf/timestamp.proto";
{{- end}}
{{- if .ImportDuration}}
import "google/protobuf/duration.proto";
{{- end}}
{{- if .ImportEmpty}}
import "google/protobuf/empty.proto";
{{- end}}

option go_package="{{.ProtoGoPackage}}";

{{- range .Defs}}
{{- if findEnum .Name}}
{{template "Enum" .}}
{{- else if findEntity .Name}}
{{template "Entity" .}}
{{- else if findComponent .Name}}
{{template "Component" .}}
{{- end}}
{{- end}}