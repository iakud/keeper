{{- /* BEGIN DEFINE */ -}}

{{- define "Enum"}}
enum {{.Name}} {
{{- range .EnumFields}}
	{{.Name}} = {{.Value}};
{{- end}}
}
{{- end}}

{{- define "Entity"}}
message {{.Name}} {
{{- range .Fields}}
{{- if .Repeated}}
{{- if isTimestamp .Type}}
	repeated google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	repeated google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else}}
	repeated {{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- else if len .KeyType}}
{{- if isTimestamp .Type}}
	map<{{.KeyType}}, google.protobuf.Timestamp> {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	map<{{.KeyType}}, google.protobuf.Duration> {{.Name}} = {{.Number}};
{{- else}}
	map<{{.KeyType}}, {{.Type}}> {{.Name}} = {{.Number}};
{{- end}}
{{- else}}
{{- if isTimestamp .Type}}
	google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else}}
	{{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- end}}
{{- end}}
}
{{- end}}

{{- define "Component"}}
message {{.Name}} {
{{- range .Fields}}
{{- if .Repeated}}
{{- if isTimestamp .Type}}
	repeated google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	repeated google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else}}
	repeated {{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- else if len .KeyType}}
{{- if isTimestamp .Type}}
	map<{{.KeyType}}, google.protobuf.Timestamp> {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	map<{{.KeyType}}, google.protobuf.Duration> {{.Name}} = {{.Number}};
{{- else}}
	map<{{.KeyType}}, {{.Type}}> {{.Name}} = {{.Number}};
{{- end}}
{{- else}}
{{- if isTimestamp .Type}}
	google.protobuf.Timestamp {{.Name}} = {{.Number}};
{{- else if isDuration .Type}}
	google.protobuf.Duration {{.Name}} = {{.Number}};
{{- else}}
	{{.Type}} {{.Name}} = {{.Number}};
{{- end}}
{{- end}}
{{- end}}
}
{{- end}}

{{- /* END DEFINE */ -}}

// Code generated by kds. DO NOT EDIT.

syntax = "proto3";

package {{.Package}};
{{""}}
{{- range .Imports}}
import "{{.}}.proto";
{{- end}}
{{- if .ImportTimestamp}}
import "google/protobuf/timestamp.proto";
{{- end}}
{{- if .ImportDuration}}
import "google/protobuf/duration.proto";
{{- end}}

option go_package="github.com/iakud/keeper/kds/kdsc/example/pb";

{{- range .Defs}}
{{- if findEnum .Name}}
{{template "Enum" .}}
{{- else if findEntity .Name}}
{{template "Entity" .}}
{{- else if findComponent .Name}}
{{template "Component" .}}
{{- end}}
{{- end}}